# Crowd Counting Using Deep Learning

This project implements a deep learning-based crowd counting system, leveraging a convolutional neural network to predict the number of people in an image by generating density map. The system includes both training and deployment aspects:

- **`crowd_count_model.ipynb`**: A Jupyter notebook to train and validate the model using the [Mall Dataset](https://www.kaggle.com/datasets/chaozhuang/mall-dataset).
- **`app.py`**: A Flask-based web application that provides an interface to upload an image and predict the crowd count.

## Project Structure

```
├── crowd_count_model.ipynb    # Jupyter notebook for training and validating the model
├── python/                    
│   └── app.py                 # Flask application for crowd count prediction
│   └── crowd_count_trained.h5 # pre-trained model 
├── static/                    
│   └── container/             # Folder to store uploaded images and generated density maps
│   └── css/                   # Contains the css file
├── templates/                 # HTML templates for the web interface
```

## Training the Model

The `crowd_count_model.ipynb` notebook:
1. Loads the Mall Dataset frames and corresponding ground truth annotations.
2. Preprocesses the images.
3. Builds a convolutional neural network (CNN) with the following layers:
   - Convolutional and pooling layers to extract spatial features.
   - Deconvolution layers to generate a density map.
   - A final layer to produce a density map representing the crowd.
4. Compiles the model using:
   - **Optimizer**: Adam
   - **Loss Function**: Mean Squared Error (MSE)
   - **Metrics**: Mean Absolute Error (MAE)
5. Trains the model and validates its performance.
6. Saves the trained model as `crowd_count_trained.h5`.

## Web Application

The `app.py` script implements a web application to predict crowd counts:

### Features
- **Upload Image**: Users can upload an image via a web interface.
- **Predict Crowd Count**: The app:
  1. Loads the pre-trained model (`crowd_count_trained.h5`).
  2. Preprocesses the uploaded image.
  3. Generates a density map and predicts the total crowd count.
  4. Displays the uploaded image, and predicted count.

### Running the Application
1. Clone this repository:
   ```bash
   git clone https://github.com/rafiaashraf/Crowd_Count.git
   cd crowd-counting
   ```
2. Install the required dependencies:
   ```bash
   pip install tensorflow==2.13.0
   pip install flask-ngrok
   pip install flask
   ```
3. Install and setup ngrok for exposing the Flask app:
   ```bash
   pip install pyngrok
   ```
4. Run the application:
   ```bash
   python app.py
   ```
5. The application will be accessible via a public URL generated by **ngrok**.


## Acknowledgments
- **Dataset**: [Mall Dataset](https://www.kaggle.com/datasets/chaozhuang/mall-dataset)

